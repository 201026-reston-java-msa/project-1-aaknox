<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReimburseMe! || Home Page</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="https://kit.fontawesome.com/b825c1b0e8.js"></script>
    <link rel="shortcut icon" href="/img/money-icon-2.png" type="image/x-icon" />
</head>

<body>
    <header>
        <h1>Select an option from below.</h1>
    </header>
    <section id="option-container">
        <div id="option">
            <i class="fas fa-file-invoice-dollar"></i> <a href="">Submit a
				Reimbursement Request</a>
        </div>
        <div id="option">
            <i class="fas fa-clipboard-list"></i> <a href="">View Past
				Requests</a>
        </div>
        <div id="option">
            <i class="fas fa-search-dollar"></i> <a href="">View Pending
				Requests</a>
        </div>
    </section>
    <br>
    <footer>
        <nav>
            <ul>
                <li><span id="welcome-message">Welcome, User!</span></li>
                <li><a onclick="profile()">View Profile</a></li>
                <li><a href="">Need Help?</a></li>
                <li><a onclick="logout()">Log Out</a></li>
            </ul>
        </nav>
    </footer>
    <script>
    function logout() {
    	console.log('logout link clicked')
		let xhr = new XMLHttpRequest();
		
		xhr.open("POST", "http://localhost:8080/project-1/logout");
		xhr.send();
		
		sessionStorage.removeItem('currentUser');
		window.location = "http://localhost:8080/project-1/";
	}
    
    function profile(){
    	console.log('profile link clicked!');
    	let xhr = new XMLHttpRequest();
    	xhr.onreadystatechange = function(){
    		if(this.readyState === 3){
    			console.log('loading...')
    		}
            if(this.readyState === 4 && this.status === 200)
            {
                console.log("Found Profile!!")
                sessionStorage.setItem('currentUser', this.responseText)
                window.location = "http://localhost:8080/project-1/profile.html"
                console.log(sessionStorage.getItem('currentUser'))
            }
            if(this.readyState ===4 && this.status ===204)
            {
                console.log("Failed to load profile")
                alert("No profile can be found for this user");
            }
            console.log("Processing profile view...")
            
        }
    	xhr.open("POST", "http://localhost:8080/project-1/user");
    	xhr.send();
    	
        window.location = "http://localhost:8080/project-1/user/profile.html"
    }
    
    let welcome = document.getElementById('welcome-message');
	let userString = sessionStorage.getItem('currentUser');
	
	if(userString === null) {
		window.location = "http://localhost:8080/project-1/";
	} else {
		console.log(userString);
		let currentUser = JSON.parse(userString);
		console.log(currentUser);
		if (currentUser != null) {
		welcome.innerHTML = "Welcome, " + currentUser.firstName + "!";
		}
	}
    </script>
</body>

</html>